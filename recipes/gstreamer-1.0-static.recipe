# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python


class Recipe(custom.GStreamerStatic):
    name = 'gstreamer-1.0-static'
    extra_configure_options = '--enable-static'
    remotes = {'origin': 'git://anongit.freedesktop.org/gstreamer/gstreamer'}
    deps = ['glib', 'gtk-doc-lite']
    # Static build will always fail on make check
    make_check = None

    files_plugins_core_devel = ['libgstcoreelements', 'libgstcoretracers']

    def prepare(self):
        self.append_env['CFLAGS'] = " -Wno-error "
        self.append_env['CXXFLAGS'] = " -Wno-error "
        self.append_env['CPPFLAGS'] = " -Wno-error "

        if self.config.target_platform != Platform.LINUX:
            self.configure_options += ' --disable-gtk-doc --disable-docbook'

        if self.config.target_platform == Platform.IOS:
            # iOS only supports static builds so plugins must be linked
            # and registered statically.
            self.configure_options += ' --disable-registry '

        if self.config.variants.nodebug:
            self.append_env['CFLAGS'] += ' -DGST_LEVEL_MAX=GST_LEVEL_FIXME'

        if self.config.variants.unwind:
            self.deps += ['libunwind']

        custom.GStreamerStatic.prepare(self)

